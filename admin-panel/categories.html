<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دسته‌بندی فروشگاه‌ها - پنل مدیریت ایرانچه</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="top-header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title">دسته‌بندی فروشگاه‌ها</h1>
                </div>
                <div class="header-right">
                    <div class="user-menu">
                        <div class="user-avatar">
                            <img src="https://via.placeholder.com/40" alt="Admin">
                        </div>
                        <span class="user-name">مدیر سیستم</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Categories Management Section -->
                <section class="content-section active">
                    <div class="section-header">
                        <h2>مدیریت طبقات و دسته‌بندی فروشگاه‌ها</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" onclick="showAddFloorModal()">
                                <i class="fas fa-plus"></i>
                                افزودن طبقه جدید
                            </button>
                            <button class="btn btn-secondary" onclick="showAddCategoryModal()">
                                <i class="fas fa-tags"></i>
                                افزودن زیردسته
                            </button>
                        </div>
                    </div>

                    <!-- Categories Grid -->
                <!-- Floors Grid -->
                <div class="floors-grid" id="floorsGrid">
                    <!-- Floors will be loaded here -->
                </div>

                <!-- Floors Table -->
                <div class="table-container">
                    <table class="data-table" id="floorsTable">
                        <thead>
                            <tr>
                                <th>نام طبقه</th>
                                <th>بازه شماره</th>
                                <th>زیردسته‌ها</th>
                                <th>تعداد فروشگاه‌ها</th>
                                <th>وضعیت</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody id="floorsTableBody">
                            <!-- Floors data will be loaded here -->
                        </tbody>
                    </table>
                </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Add Floor Modal -->
    <div id="addFloorModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>افزودن طبقه جدید</h3>
                <button class="modal-close" onclick="closeAddFloorModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addFloorForm" class="floor-form">
                    <div class="form-group">
                        <label for="floorName">نام طبقه *</label>
                        <input type="text" id="floorName" name="name" required 
                               placeholder="مثال: پوشاک، الکترونیک، کتاب">
                    </div>
                    
                    <div class="form-group">
                        <label for="floorShortDescription">توضیح کوتاه *</label>
                        <input type="text" id="floorShortDescription" name="shortDescription" required 
                               placeholder="توضیح کوتاه طبقه">
                    </div>
                    
                    <div class="form-group">
                        <label>بازه شماره‌های طبقه</label>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="floorStartNumber">بازه شروع طبقه *</label>
                                <input type="number" id="floorStartNumber" name="start_number" required min="0" placeholder="مثال: 1000">
                            </div>
                            <div class="form-group">
                                <label for="floorEndNumber">بازه پایان طبقه *</label>
                                <input type="number" id="floorEndNumber" name="end_number" required min="0" placeholder="مثال: 1999">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="floorLongDescription">توضیح بلند</label>
                        <textarea id="floorLongDescription" name="longDescription" rows="4"
                                  placeholder="توضیح کامل طبقه و محصولات آن"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="floorIcon">آیکون</label>
                        <select id="floorIcon" name="icon">
                            <option value="fas fa-tshirt">پوشاک</option>
                            <option value="fas fa-laptop">الکترونیک</option>
                            <option value="fas fa-book">کتاب</option>
                            <option value="fas fa-home">خانه و آشپزخانه</option>
                            <option value="fas fa-car">خودرو</option>
                            <option value="fas fa-gamepad">بازی و سرگرمی</option>
                            <option value="fas fa-heart">سلامت و زیبایی</option>
                            <option value="fas fa-utensils">غذا و نوشیدنی</option>
                            <option value="fas fa-dumbbell">ورزش و تناسب اندام</option>
                            <option value="fas fa-baby">کودک و نوزاد</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="floorColor">رنگ طبقه</label>
                        <input type="color" id="floorColor" name="color" value="#3B82F6">
                    </div>
                    
                    <div class="form-group">
                        <label for="floorBanner">آدرس بنر</label>
                        <input type="url" id="floorBanner" name="banner_url" 
                               placeholder="https://example.com/banner.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="floorStatus">وضعیت</label>
                        <select id="floorStatus" name="status">
                            <option value="active">فعال</option>
                            <option value="inactive">غیرفعال</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeAddFloorModal()">
                            انصراف
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            ذخیره طبقه
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="addCategoryModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>افزودن دسته جدید</h3>
                <button class="modal-close" onclick="closeAddCategoryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addCategoryForm" class="category-form">
                    <div class="form-group">
                        <label for="categoryName">نام زیردسته *</label>
                        <input type="text" id="categoryName" name="name" required 
                               placeholder="مثال: لباس، کفش، اکسسوری">
                    </div>
                    
                    <div class="form-group">
                        <label for="categoryParentFloor">طبقه والد *</label>
                        <select id="categoryParentFloor" name="parentFloor" required>
                            <option value="">انتخاب طبقه والد</option>
                            <!-- Floors will be loaded here -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="categoryDescription">توضیحات</label>
                        <textarea id="categoryDescription" name="description" rows="3"
                                  placeholder="توضیحات کوتاه درباره این زیردسته"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="categoryIcon">آیکون</label>
                        <select id="categoryIcon" name="icon">
                            <option value="fas fa-tshirt">پوشاک</option>
                            <option value="fas fa-laptop">الکترونیک</option>
                            <option value="fas fa-book">کتاب</option>
                            <option value="fas fa-home">خانه و آشپزخانه</option>
                            <option value="fas fa-car">خودرو</option>
                            <option value="fas fa-gamepad">بازی و سرگرمی</option>
                            <option value="fas fa-heart">سلامت و زیبایی</option>
                            <option value="fas fa-utensils">غذا و نوشیدنی</option>
                            <option value="fas fa-dumbbell">ورزش و تناسب اندام</option>
                            <option value="fas fa-baby">کودک و نوزاد</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="categoryColor">رنگ دسته</label>
                        <input type="color" id="categoryColor" name="color" value="#3B82F6">
                    </div>
                    
                    <div class="form-group">
                        <label for="categoryBanner">آدرس بنر</label>
                        <input type="url" id="categoryBanner" name="banner_url" 
                               placeholder="https://example.com/banner.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="categoryStatus">وضعیت</label>
                        <select id="categoryStatus" name="status">
                            <option value="active">فعال</option>
                            <option value="inactive">غیرفعال</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeAddCategoryModal()">
                            انصراف
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            ذخیره دسته
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div id="editCategoryModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>ویرایش دسته</h3>
                <button class="modal-close" onclick="closeEditCategoryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editCategoryForm" class="category-form">
                    <input type="hidden" id="editCategoryId" name="id">
                    
                    <div class="form-group">
                        <label for="editCategoryName">نام دسته *</label>
                        <input type="text" id="editCategoryName" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCategoryDescription">توضیحات</label>
                        <textarea id="editCategoryDescription" name="description" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCategoryIcon">آیکون</label>
                        <select id="editCategoryIcon" name="icon">
                            <option value="fas fa-tshirt">پوشاک</option>
                            <option value="fas fa-laptop">الکترونیک</option>
                            <option value="fas fa-book">کتاب</option>
                            <option value="fas fa-home">خانه و آشپزخانه</option>
                            <option value="fas fa-car">خودرو</option>
                            <option value="fas fa-gamepad">بازی و سرگرمی</option>
                            <option value="fas fa-heart">سلامت و زیبایی</option>
                            <option value="fas fa-utensils">غذا و نوشیدنی</option>
                            <option value="fas fa-dumbbell">ورزش و تناسب اندام</option>
                            <option value="fas fa-baby">کودک و نوزاد</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCategoryColor">رنگ دسته</label>
                        <input type="color" id="editCategoryColor" name="color">
                    </div>
                    
                    <div class="form-group">
                        <label for="editCategoryStatus">وضعیت</label>
                        <select id="editCategoryStatus" name="status">
                            <option value="active">فعال</option>
                            <option value="inactive">غیرفعال</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeEditCategoryModal()">
                            انصراف
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            ذخیره تغییرات
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Floor Modal -->
    <div id="deleteFloorModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>حذف طبقه</h3>
                <button class="modal-close" onclick="closeDeleteFloorModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="delete-confirmation">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>آیا مطمئن هستید که می‌خواهید این طبقه را حذف کنید؟</p>
                    <p class="warning-text">این عمل قابل بازگشت نیست و تمام زیردسته‌های این طبقه نیز حذف خواهند شد.</p>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDeleteFloorModal()">
                        انصراف
                    </button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteFloor()">
                        <i class="fas fa-trash"></i>
                        حذف طبقه
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteCategoryModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>حذف دسته</h3>
                <button class="modal-close" onclick="closeDeleteCategoryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="delete-confirmation">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>آیا مطمئن هستید که می‌خواهید این دسته را حذف کنید؟</p>
                    <p class="warning-text">این عمل قابل بازگشت نیست و تمام فروشگاه‌های این دسته به دسته "عمومی" منتقل خواهند شد.</p>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDeleteCategoryModal()">
                        انصراف
                    </button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteCategory()">
                        <i class="fas fa-trash"></i>
                        حذف دسته
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>در حال بارگذاری...</p>
        </div>
    </div>

    <script>
        // Floors and Categories Management JavaScript
        let floors = [];
        let categories = [];
        let currentEditingFloor = null;
        let currentEditingCategory = null;
        let currentDeletingFloor = null;
        let currentDeletingCategory = null;

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadFloors();
            setupEventListeners();
        });

        function setupEventListeners() {

            // Add floor form
            document.getElementById('addFloorForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addFloor();
            });

            // Add category form
            document.getElementById('addCategoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addCategory();
            });

            // Edit category form
            document.getElementById('editCategoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateCategory();
            });
        }

        async function loadFloors() {
            showLoading();
            
            try {
                // Load floors from API
                const floorsResponse = await fetch('http://localhost:3000/api/categories/floors');
                const floorsData = await floorsResponse.json();
                
                if (floorsData.success) {
                    floors = floorsData.data.map(floor => ({
                        ...floor,
                        shortDescription: floor.short_description,
                        longDescription: floor.long_description,
                        storeCount: floor.store_count,
                        numberRange: floor.number_range,
                        startNumber: floor.start_number,
                        endNumber: floor.end_number
                    }));
                }

                // Load categories from API
                const categoriesResponse = await fetch('http://localhost:3000/api/categories/categories');
                const categoriesData = await categoriesResponse.json();
                
                if (categoriesData.success) {
                    categories = categoriesData.data.map(category => ({
                        ...category,
                        parentFloor: category.floor_name,
                        parentFloorId: category.floor_id,
                        storeCount: category.store_count
                    }));
                }

                renderFloors();
                updateParentFloorOptions();
                hideLoading();
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('خطا در بارگذاری داده‌ها', 'error');
                hideLoading();
            }
        }


        function renderFloors() {
            const grid = document.getElementById('floorsGrid');
            const tableBody = document.getElementById('floorsTableBody');
            
            // Clear existing content
            grid.innerHTML = '';
            tableBody.innerHTML = '';
            
            floors.forEach(floor => {
                // Grid view
                const floorCard = createFloorCard(floor);
                grid.appendChild(floorCard);
                
                // Table view
                const tableRow = createFloorTableRow(floor);
                tableBody.appendChild(tableRow);
            });
        }

        function createFloorCard(floor) {
            const card = document.createElement('div');
            card.className = 'floor-card';
            card.innerHTML = `
                <div class="floor-card-header">
                    <div class="floor-icon" style="background-color: ${floor.color}">
                        <i class="${floor.icon}"></i>
                    </div>
                    <div class="floor-actions">
                        <button class="btn-icon" onclick="editFloor(${floor.id})" title="ویرایش">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-icon" onclick="deleteFloor(${floor.id})" title="حذف">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="floor-card-body">
                    <h3>${floor.name}</h3>
                    <p class="floor-short-desc">${floor.shortDescription}</p>
                    <div class="floor-stats">
                        <span class="stat">
                            <i class="fas fa-store"></i>
                            ${floor.storeCount} فروشگاه
                        </span>
                        <span class="number-range">
                            <i class="fas fa-hashtag"></i>
                            ${floor.numberRange}
                        </span>
                    </div>
                    <div class="floor-status">
                        <span class="status ${floor.status}">
                            ${floor.status === 'active' ? 'فعال' : 'غیرفعال'}
                        </span>
                    </div>
                </div>
            `;
            return card;
        }

        function createFloorTableRow(floor) {
            const row = document.createElement('tr');
            
            // Get subcategories for this floor
            const subcategories = categories.filter(cat => cat.parentFloorId === floor.id);
            
            // Create subcategories tree HTML
            let subcategoriesHTML = '';
            if (subcategories.length > 0) {
                subcategoriesHTML = '<div class="subcategories-tree">';
                subcategories.forEach(sub => {
                    subcategoriesHTML += `
                        <div class="subcategory-item" onclick="editCategory(${sub.id})" title="کلیک برای ویرایش">
                            <i class="fas fa-tag"></i>
                            <span class="subcategory-name">${sub.name}</span>
                            <span class="subcategory-count">(${sub.storeCount})</span>
                        </div>
                    `;
                });
                subcategoriesHTML += '</div>';
            } else {
                subcategoriesHTML = '<span class="no-subcategories">هیچ زیردسته‌ای وجود ندارد</span>';
            }
            
            row.innerHTML = `
                <td>
                    <div class="floor-info">
                        <div class="floor-icon-small" style="background-color: ${floor.color}">
                            <i class="${floor.icon}"></i>
                        </div>
                        <span>${floor.name}</span>
                    </div>
                </td>
                <td>
                    <span class="number-range-badge">${floor.numberRange}</span>
                </td>
                <td>
                    ${subcategoriesHTML}
                </td>
                <td>${floor.storeCount}</td>
                <td>
                    <span class="status ${floor.status}">
                        ${floor.status === 'active' ? 'فعال' : 'غیرفعال'}
                    </span>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-icon" onclick="editFloor(${floor.id})" title="ویرایش">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-icon" onclick="deleteFloor(${floor.id})" title="حذف">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            return row;
        }



        function showAddFloorModal() {
            document.getElementById('addFloorModal').style.display = 'flex';
            document.getElementById('addFloorForm').reset();
        }

        function closeAddFloorModal() {
            document.getElementById('addFloorModal').style.display = 'none';
        }

        function showAddCategoryModal() {
            document.getElementById('addCategoryModal').style.display = 'flex';
            document.getElementById('addCategoryForm').reset();
            updateParentFloorOptions();
        }

        function closeAddCategoryModal() {
            document.getElementById('addCategoryModal').style.display = 'none';
        }

        function updateParentFloorOptions() {
            const select = document.getElementById('categoryParentFloor');
            if (!select) return;
            
            select.innerHTML = '<option value="">انتخاب طبقه والد</option>';
            floors.forEach(floor => {
                const option = document.createElement('option');
                option.value = floor.id;
                option.textContent = floor.name;
                select.appendChild(option);
            });
        }

        function showEditCategoryModal(category) {
            currentEditingCategory = category;
            document.getElementById('editCategoryId').value = category.id;
            document.getElementById('editCategoryName').value = category.name;
            document.getElementById('editCategoryDescription').value = category.description;
            document.getElementById('editCategoryIcon').value = category.icon;
            document.getElementById('editCategoryColor').value = category.color;
            document.getElementById('editCategoryStatus').value = category.status;
            document.getElementById('editCategoryModal').style.display = 'flex';
        }

        function closeEditCategoryModal() {
            document.getElementById('editCategoryModal').style.display = 'none';
            currentEditingCategory = null;
        }

        function showDeleteCategoryModal(category) {
            currentDeletingCategory = category;
            document.getElementById('deleteCategoryModal').style.display = 'flex';
        }

        function closeDeleteCategoryModal() {
            document.getElementById('deleteCategoryModal').style.display = 'none';
            currentDeletingCategory = null;
        }

        async function addCategory() {
            const formData = new FormData(document.getElementById('addCategoryForm'));
            const categoryData = {
                floor_id: parseInt(formData.get('parentFloor')),
                name: formData.get('name'),
                description: formData.get('description'),
                icon: formData.get('icon'),
                color: formData.get('color'),
                banner_url: formData.get('banner_url'),
                status: formData.get('status')
            };

            try {
                const response = await fetch('http://localhost:3000/api/categories/categories', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(categoryData)
                });

                const result = await response.json();
                
                if (result.success) {
                    showNotification('زیردسته جدید با موفقیت اضافه شد', 'success');
                    closeAddCategoryModal();
                    loadFloors(); // Reload data from API
                } else {
                    showNotification(result.message || 'خطا در افزودن زیردسته', 'error');
                }
            } catch (error) {
                console.error('Error adding category:', error);
                showNotification('خطا در افزودن زیردسته', 'error');
            }
        }

        function editCategory(id) {
            const category = categories.find(c => c.id === id);
            if (category) {
                showEditCategoryModal(category);
            }
        }

        function updateCategory() {
            const formData = new FormData(document.getElementById('editCategoryForm'));
            const categoryId = parseInt(formData.get('id'));
            const categoryIndex = categories.findIndex(c => c.id === categoryId);
            
            if (categoryIndex !== -1) {
                categories[categoryIndex] = {
                    ...categories[categoryIndex],
                    name: formData.get('name'),
                    description: formData.get('description'),
                    icon: formData.get('icon'),
                    color: formData.get('color'),
                    status: formData.get('status')
                };
                
                renderCategories();
                closeEditCategoryModal();
                showNotification('دسته با موفقیت ویرایش شد', 'success');
            }
        }

        function deleteCategory(id) {
            const category = categories.find(c => c.id === id);
            if (category) {
                showDeleteCategoryModal(category);
            }
        }

        function confirmDeleteCategory() {
            if (currentDeletingCategory) {
                const categoryIndex = categories.findIndex(c => c.id === currentDeletingCategory.id);
                if (categoryIndex !== -1) {
                    categories.splice(categoryIndex, 1);
                    renderCategories();
                    closeDeleteCategoryModal();
                    showNotification('دسته با موفقیت حذف شد', 'success');
                }
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fa-IR');
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : 'info'}-circle"></i>
                <span>${message}</span>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Floor management functions
        function editFloor(id) {
            const floor = floors.find(f => f.id === id);
            if (floor) {
                showEditFloorModal(floor);
            }
        }

        function deleteFloor(id) {
            currentDeletingFloor = floors.find(f => f.id === id);
            if (currentDeletingFloor) {
                showDeleteFloorModal(currentDeletingFloor);
            }
        }

        function showEditFloorModal(floor) {
            currentEditingFloor = floor;
            // Implementation for edit floor modal
            console.log('Edit floor:', floor);
        }

        function showDeleteFloorModal(floor) {
            currentDeletingFloor = floor;
            document.getElementById('deleteFloorName').textContent = floor.name;
            document.getElementById('deleteFloorModal').style.display = 'flex';
        }

        function closeDeleteFloorModal() {
            document.getElementById('deleteFloorModal').style.display = 'none';
            currentDeletingFloor = null;
        }

        async function addFloor() {
            const formData = new FormData(document.getElementById('addFloorForm'));
            const floorData = {
                name: formData.get('name'),
                short_description: formData.get('shortDescription'),
                long_description: formData.get('longDescription'),
                icon: formData.get('icon'),
                color: formData.get('color'),
                banner_url: formData.get('banner_url'),
                status: formData.get('status'),
                start_number: parseInt(formData.get('start_number')), 
                end_number: parseInt(formData.get('end_number'))
            };

            try {
                const response = await fetch('http://localhost:3000/api/categories/floors', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(floorData)
                });

                const result = await response.json();
                
                if (result.success) {
                    showNotification('طبقه جدید با موفقیت اضافه شد', 'success');
                    closeAddFloorModal();
                    loadFloors(); // Reload data from API
                } else {
                    showNotification(result.message || 'خطا در افزودن طبقه', 'error');
                }
            } catch (error) {
                console.error('Error adding floor:', error);
                showNotification('خطا در افزودن طبقه', 'error');
            }
        }

        function confirmDeleteFloor() {
            if (currentDeletingFloor) {
                floors = floors.filter(f => f.id !== currentDeletingFloor.id);
                renderFloors();
                updateParentFloorOptions();
                closeDeleteFloorModal();
                showNotification('طبقه با موفقیت حذف شد', 'success');
            }
        }
    </script>
    <script src="js/common.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/load-sidebar.js"></script>
    <script src="js/sidebar.js"></script>
</body>
</html>
